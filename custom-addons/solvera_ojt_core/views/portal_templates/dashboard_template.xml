<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_participant_dashboard" name="OJT Participant Dashboard">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs" t-value="[('My Account', '/my/home'), ('Dashboard', '/my/dashboard')]"/>

            <div class="container pb-5">
                
                <!-- Header -->
                <div class="text-center text-white mb-2 p-5 rounded-4 shadow-sm bg-primary">
                    <h2>Selamat Datang, <strong><t t-esc="participant.partner_id.name"/></strong> ðŸ‘‹</h2>
                    <p class="lead">Batch: <strong><t t-esc="participant.batch_id.name"/></strong></p>

                </div>
                <t t-if="participant.batch_id.state == 'done'">
                    <div class="alert alert-light d-flex justify-content-start gap-4 align-items-center mb-4 text-start" 
                        role="alert" 
                        style="color: #0f5132; background-color: #d1e7dd; border-color: #badbcc;">
                        <i class="fa fa-trophy fa-2x ms-3"></i>
                        <div>
                            <h5 class="alert-heading mb-1 fw-bold">Program Selesai!</h5>
                            Selamat, Anda telah berhasil menyelesaikan program ini.
                        </div>
                    </div>
                </t>

                <!-- Progress Summary -->
                <h4 class="border-start border-4 border-primary ps-2 fw-semibold mb-4">Ringkasan Progres</h4>
                <div class="row text-center g-4 mb-5">
                    <div class="col-md-4">
                        <div class="card p-4 shadow-sm rounded-4">
                            <h6 class="text-muted">Nilai Akhir</h6>
                            <h2 class="text-primary fw-bold"><t t-esc="'%.2f' % participant.score_final"/></h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 shadow-sm rounded-4">
                            <h6 class="text-muted">Tingkat Kehadiran</h6>
                            <h2 class="text-success fw-bold"><t t-esc="'%.1f' % participant.attendance_rate"/>%</h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card p-4 shadow-sm rounded-4">
                            <h6 class="text-muted">Tugas Selesai</h6>
                            <h2 class="text-warning fw-bold">
                                <t t-esc="progress_data['assignment_completed_count']"/> /
                                <t t-esc="progress_data['assignment_total_count']"/>
                            </h2>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Assignments -->
                    <div class="col-lg-7">
                        <h4 class="border-start border-4 border-primary ps-2 fw-semibold mb-3">Daftar Tugas</h4>
                        <div class="list-group">
                            <t t-if="not assignments">
                                <div class="list-group-item">Belum ada tugas.</div>
                            </t>
                            <t t-foreach="assignments" t-as="assignment">
                                <a t-attf-href="/my/assignment/#{assignment.id}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center rounded-3 mb-2">
                                    <div>
                                        <h6 class="mb-1"><t t-esc="assignment.name"/></h6>
                                        <small class="text-muted"><i class="fa fa-calendar me-1"/>Deadline:
                                            <span t-field="assignment.deadline" t-options='{"format": "dd MMM yyyy"}'/>
                                        </small>
                                    </div>
                                    <t t-set="submission" t-value="assignment.submit_ids.filtered(lambda s: s.participant_id.id == participant.id)"/>
                                    <t t-if="submission">
                                        <span class="badge bg-success rounded-pill">Submitted</span>
                                    </t>
                                    <t t-else="">
                                        <span class="badge bg-warning text-dark rounded-pill">Pending</span>
                                    </t>
                                </a>
                            </t>
                        </div>
                    </div>

                    <!-- Agenda -->
                    <div class="col-lg-5">
                        <h4 class="border-start border-4 border-primary ps-2 fw-semibold mb-3">Agenda Terdekat</h4>
                        <ul class="list-group">
                            <t t-if="not agenda_items">
                                <li class="list-group-item">Belum ada agenda.</li>
                            </t>
                            <t t-foreach="agenda_items" t-as="agenda">
                                <a t-attf-href="/my/agenda/#{agenda.id}" class="list-group-item list-group-item-action rounded-3 mb-2">
                                    <strong><t t-esc="agenda.event_id.name"/></strong><br/>
                                    <small class="text-muted"><i class="fa fa-clock me-1"/><span t-field="agenda.event_id.date_begin" t-options='{"format": "dd MMM yyyy, HH:mm"}'/></small>
                                </a>
                            </t>
                        </ul>
                    </div>
                </div>

                <!-- Surveys -->
                <div class="mt-5">
                    <h4 class="border-start border-4 border-primary ps-2 fw-semibold mb-3">Survei &amp; Evaluasi</h4>
                    <div class="list-group">
                        <t t-if="not surveys">
                            <div class="list-group-item">Belum ada survei yang tersedia.</div>
                        </t>
                        <t t-foreach="survey_data" t-as="s_data">
                            <div t-if="s_data['is_done']" class="list-group-item d-flex justify-content-between align-items-center bg-light rounded-3 mb-2">
                                <div>
                                    <h6 class="mb-1 text-muted"><t t-esc="s_data['survey'].title"/></h6>
                                    <small class="text-muted">Anda sudah menyelesaikan survei ini.</small>
                                </div>
                                <span class="badge bg-success rounded-pill"><i class="fa fa-check"/> Selesai</span>
                            </div>
                            <a t-else="" t-att-href="s_data['survey'].get_start_url()" target="_blank"
                                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center rounded-3 mb-2">
                                <div>
                                    <h6 class="mb-1"><t t-esc="s_data['survey'].title"/></h6>
                                    <small class="text-muted">Klik untuk memulai</small>
                                </div>
                                <span class="badge bg-primary rounded-pill">Mulai Survei</span>
                            </a>
                        </t>
                    </div>
                </div>

                <!-- Certificate -->
                <div class="mt-5">
                    <h4 class="border-start border-4 border-primary ps-2 fw-semibold mb-3">Sertifikat</h4>
                    <div class="list-group">
                        <div class="card mb-3 border-0 shadow-sm rounded-3 certificate-card">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">Program: <strong><t t-esc="participant.batch_id.name"/></strong></h5>
                                    <small class="text-muted">
                                        Status: 
                                        <t t-if="certificate_data and certificate_data.state == 'issued'">
                                            <span class="badge bg-success certificate-badge">Telah Terbit</span>
                                        </t>
                                        <t t-else="">
                                            <span class="badge bg-secondary certificate-badge">Belum Tersedia</span>
                                        </t>
                                    </small>
                                </div>
                                <div>
                                    <t t-if="certificate_data and certificate_data.state == 'issued'">
                                        <a t-attf-href="/my/certificate/download/#{certificate_data.id}" class="btn btn-primary btn-sm">
                                            <i class="fa fa-download"></i> Unduh Sertifikat
                                        </a>
                                    </t>
                                    <t t-else="">
                                        <button class="btn btn-outline-secondary btn-sm" disabled="disabled">
                                            <i class="fa fa-clock"></i> Menunggu Terbit
                                        </button>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>